---
title: "Generate Data"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Overview

* Generate $10^5$ observations from a 3D grid, using `RandomFields`
* Generate fake predictors
* Save the data

## Simulation

The simulation study.

```{r install the moderated GpGp Pkg}
library(lhs)
library(RandomFields)
set.seed(123)
```

Generate observations.
```{r gen obs}
RFoptions(spConform=FALSE)
set.seed(123)
var <- 1
tausq <- 0.05^2
r0 <- c(1, 0.5)
loc1 <- (1 : 320) * r0[1]
loc2 <- (1 : 320) * r0[2]
scale <- 32
model <- RMwhittle(var = var, scale = scale, nu = 2.5)
y <- RFsimulate(model, x = loc1, y = loc2, grid = T)
```

Define `d`.
```{r d and m}
d <- 1e3
```

Build the independent predictors and `y`.
```{r indep predictors}
n <- length(y)
locsT <- matrix(NA, n, 2)
yTmp <- rep(NA, n)
for(i1 in 1 : length(loc1))
{
  idx <- ((i1 - 1) * length(loc2) + 1) : 
    ((i1 - 1) * length(loc2) + length(loc2)) 
  locsT[idx, ] <- cbind(loc1[i1] / r0[1] / scale, 
                        loc2 / r0[2] / scale)
  yTmp[idx] <- y[i1, ]
}
y <- yTmp
colNorm <- sqrt(sum(locsT[, 1]^2))
locsF <- randomLHS(n, d - 2)
locsF <- locsF * outer(rep(colNorm, n), 
                     1 / sqrt(colSums(locsF^2)))
locs <- cbind(locsT, locsF)
cat("Independent predictors generated \n")
```

Add noise to `y`.
```{r demean y}
y <- y + rnorm(n, 0, var * tausq)
```

Set aside OOS dataset.
```{r OOS}
nOOS <- 5e3
idxOOS <- sample(1 : n, nOOS)
yOOS <- y[idxOOS]
locsOOS <- locs[idxOOS, , drop = F]
y <- y[-idxOOS]
locs <- locs[-idxOOS, , drop = F]
n <- n - nOOS
cat("Out of sample data separated\n")
```

Store results.
```{r save the result}
save(list = c("d", "n", "locs", "y", "nOOS", "locsOOS", "yOOS", "var", "r0",
              "tausq"), 
     file = paste0("simulation_data", ".RData"))
```
















